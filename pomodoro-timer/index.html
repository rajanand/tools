<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pomodoro Timer Â· Rajanand Tools</title>

  <link rel="icon" href="https://rajanand.org/favicon.ico" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

  <style>
    :root {
      --canvas: #f3f3f3;
      --panel: #ffffff;
      --topbar-bg: #f3f3f3;
      --text: #1f2328;
      --muted: #6e7781;
      --border: #d0d7de;
      --accent: #F54E00;
    }

    [data-theme="dark"] {
      --canvas: #1e1e1e;
      --panel: #252526;
      --topbar-bg: #252526;
      --text: #d4d4d4;
      --muted: #9da0a6;
      --border: #3c3c3c;
      --accent: #F9BD2B;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--canvas);
      color: var(--text);
    }

    .app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .topbar {
      height: 48px;
      background: var(--topbar-bg);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 0 16px;
    }

    .logo-link {
      font-size: 18px;
      font-weight: 700;
      color: var(--text);
      text-decoration: none;
    }

    .topbar-spacer { flex: 1; }

    .topbar-link {
      font-size: 13px;
      font-weight: 600;
      padding: 6px 12px;
      border-radius: 6px;
      background: var(--accent);
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      text-decoration: none;
    }

    [data-theme="dark"] .topbar-link { color: #1e1e1e; }

    #themeToggle {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 1px solid var(--border);
      background: transparent;
      cursor: pointer;
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    main {
      padding: 24px;
      max-width: 720px;
      width: 100%;
      margin: 0 auto;
    }

    .timer-card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 32px;
      text-align: center;
    }

    .mode {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 12px;
    }

    .time {
      font-size: 64px;
      font-weight: 700;
      letter-spacing: 1px;
      margin: 12px 0 24px;
    }

    .progress {
      margin: 12px auto 0;
      display: block;
    }

    .controls {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      padding: 10px 18px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: transparent;
      cursor: pointer;
      font-weight: 600;
      color: var(--text);
    }

    .btn.primary {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    [data-theme="dark"] .btn.primary { color: #1e1e1e; }

    .settings {
      margin-top: 24px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
    }

    .settings label {
      font-size: 12px;
      color: var(--muted);
      display: block;
      margin-bottom: 4px;
    }

    .settings input {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
    }

    footer {
      margin-top: auto;
      background: var(--topbar-bg);
      border-top: 1px solid var(--border);
      padding: 10px 16px;
      display: flex;
      justify-content: flex-end;
    }

    .socials a {
      margin-left: 14px;
      color: var(--muted);
      font-size: 16px;
      text-decoration: none;
    }

    .socials a:hover { color: var(--accent); }
  </style>
</head>
<body>
<div class="app">

  <header class="topbar">
    <a href="https://rajanand.org/tools" class="logo-link">____Rajanand</a>
    <div class="topbar-spacer"></div>
    <a href="https://rajanand.substack.com/s/vibe-coding" class="topbar-link">
      <i class="fa-regular fa-circle-question"></i>
      How this works
    </a>
    <a href="https://rajanand.org/tools" class="topbar-link">
      <i class="fa-solid fa-toolbox"></i>
      Toolbox
    </a>
    <button id="themeToggle"><i class="fa-regular fa-moon"></i></button>
  </header>

  <main>
    <h1>Pomodoro Timer</h1>

    <div class="timer-card">
      <div class="mode" id="modeLabel">Focus</div>

      <svg class="progress" width="180" height="180" viewBox="0 0 180 180">
        <circle cx="90" cy="90" r="80" stroke="var(--border)" stroke-width="10" fill="none" />
        <circle id="progressCircle" cx="90" cy="90" r="80" stroke="var(--accent)" stroke-width="10" fill="none"
                stroke-linecap="round" transform="rotate(-90 90 90)" />
      </svg>

      <div class="time" id="timeDisplay">25:00</div>

      <div class="controls">
        <button class="btn primary" id="startPause">Start</button>
        <button class="btn" id="reset">Reset</button>
        <button class="btn" id="skip">Skip</button>
      </div>

      <div class="settings">
        <div>
          <label>Focus (min)</label>
          <input type="number" id="focusInput" value="25" min="1" />
        </div>
        <div>
          <label>Short Break</label>
          <input type="number" id="shortInput" value="5" min="1" />
        </div>
        <div>
          <label>Long Break</label>
          <input type="number" id="longInput" value="15" min="1" />
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="socials">
      <a href="https://github.com/rajanand/tools" title="Source Code"><i class="fa-solid fa-code"></i></a>
      <a href="https://rajanand.org/tools" title="Tools"><i class="fa-solid fa-globe"></i></a>
      <a href="https://x.com/iRajanand" title="X"><i class="fa-brands fa-x-twitter"></i></a>
      <a href="https://www.linkedin.com/in/iRajanand" title="LinkedIn"><i class="fa-brands fa-linkedin"></i></a>
      <a href="https://github.com/rajanand" title="GitHub"><i class="fa-brands fa-github"></i></a>
      <a href="https://rajanand.substack.com/welcome" title="Substack"><i class="fa-regular fa-envelope"></i></a>
    </div>
  </footer>
</div>

<script>
  const toggle = document.getElementById('themeToggle');
  const storedTheme = localStorage.getItem('theme');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

  function applyTheme(t) {
    document.documentElement.setAttribute('data-theme', t);
    toggle.innerHTML = t === 'dark'
      ? '<i class="fa-regular fa-sun"></i>'
      : '<i class="fa-regular fa-moon"></i>';
  }

  applyTheme(storedTheme || (prefersDark ? 'dark' : 'light'));

  toggle.onclick = () => {
    const next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    localStorage.setItem('theme', next);
    applyTheme(next);
  };

  const STORAGE_KEY = 'pomodoro_state';

  function loadState() {
    try {
      return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
    } catch {
      return {};
    }
  }

  function saveState() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
      focus: Number(focusInput.value),
      short: Number(shortInput.value),
      long: Number(longInput.value),
      mode,
      remaining,
      cycle
    }));
  }

  let timer = null;
  let running = false;

  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  function playBeep() {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.value = 880;
    gain.gain.value = 0.1;
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.15);
  }

  const progressCircle = document.getElementById('progressCircle');
  const radius = 80;
  const circumference = 2 * Math.PI * radius;
  progressCircle.style.strokeDasharray = circumference;

  const state = loadState();

  const focusInput = document.getElementById('focusInput');
  const shortInput = document.getElementById('shortInput');
  const longInput = document.getElementById('longInput');

  let mode = state.mode || 'focus';
  let cycle = state.cycle || 0;

  focusInput.value = state.focus || 25;
  shortInput.value = state.short || 5;
  longInput.value = state.long || 15;

  let remaining = state.remaining || focusInput.value * 60;

  const display = document.getElementById('timeDisplay');
  const modeLabel = document.getElementById('modeLabel');
  const startPause = document.getElementById('startPause');
  const resetBtn = document.getElementById('reset');
  const skipBtn = document.getElementById('skip');

  function updateProgress() {
    const total = (
      mode === 'focus' ? focusInput.value :
      mode === 'short' ? shortInput.value : longInput.value
    ) * 60;
    const offset = circumference * (1 - remaining / total);
    progressCircle.style.strokeDashoffset = offset;
  }

  function updateDisplay() {
    const m = Math.floor(remaining / 60);
    const s = remaining % 60;
    display.textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    updateProgress();
  }

  function setMode(nextMode) {
    mode = nextMode;
    modeLabel.textContent =
      mode === 'focus' ? 'Focus' : mode === 'short' ? 'Short Break' : 'Long Break';

    const mins =
      mode === 'focus' ? focusInput.value :
      mode === 'short' ? shortInput.value : longInput.value;

    remaining = mins * 60;
    updateDisplay();
    saveState();
  }

  function tick() {
    if (remaining > 0) {
      remaining--;
      updateDisplay();
      saveState();
    } else {
      playBeep();
      clearInterval(timer);
      running = false;
      startPause.textContent = 'Start';

      if (mode === 'focus') {
        cycle++;
        setMode(cycle % 4 === 0 ? 'long' : 'short');
      } else {
        setMode('focus');
      }
    }
  }

  startPause.onclick = () => {
    if (!running) {
      timer = setInterval(tick, 1000);
      running = true;
      startPause.textContent = 'Pause';
    } else {
      clearInterval(timer);
      running = false;
      startPause.textContent = 'Start';
      saveState();
    }
  };

  resetBtn.onclick = () => {
    clearInterval(timer);
    running = false;
    cycle = 0;
    startPause.textContent = 'Start';
    setMode('focus');
  };

  skipBtn.onclick = () => {
    clearInterval(timer);
    running = false;
    startPause.textContent = 'Start';
    if (mode === 'focus') {
      cycle++;
      setMode(cycle % 4 === 0 ? 'long' : 'short');
    } else {
      setMode('focus');
    }
  };

  focusInput.onchange = shortInput.onchange = longInput.onchange = () => {
    if (!running) setMode(mode);
  };

  document.addEventListener('keydown', (e) => {
    if (e.code === 'Space') {
      e.preventDefault();
      startPause.click();
    }
    if (e.key === 'r') resetBtn.click();
    if (e.key === 's') skipBtn.click();
  });

  updateDisplay();
  saveState();
</script>
</body>
</html>
